<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2">















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="前言经过 Redis 深度探险系列的学习相信大家对 Redis 的数据结构、对象、持久化机制、过期键删除策略等知识有了大致的了解，本篇博文主要讲述 Redis 的安装步骤，然后介绍一下 Redis 配置说明，最后对 Redis 集群搭建进行详细的讲解。">
<meta name="keywords" content="安装教程,配置说明,Redis">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis 深度探险（三）：Redis 单机环境搭建以及配置说明">
<meta property="og:url" content="http://blog.maoning.pro/archives/14348371.html">
<meta property="og:site_name" content="猫宁i">
<meta property="og:description" content="前言经过 Redis 深度探险系列的学习相信大家对 Redis 的数据结构、对象、持久化机制、过期键删除策略等知识有了大致的了解，本篇博文主要讲述 Redis 的安装步骤，然后介绍一下 Redis 配置说明，最后对 Redis 集群搭建进行详细的讲解。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.maoning.pro/images/2019_05_dsc03571.jpg">
<meta property="og:updated_time" content="2019-11-20T11:09:41.339Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redis 深度探险（三）：Redis 单机环境搭建以及配置说明">
<meta name="twitter:description" content="前言经过 Redis 深度探险系列的学习相信大家对 Redis 的数据结构、对象、持久化机制、过期键删除策略等知识有了大致的了解，本篇博文主要讲述 Redis 的安装步骤，然后介绍一下 Redis 配置说明，最后对 Redis 集群搭建进行详细的讲解。">
<meta name="twitter:image" content="http://blog.maoning.pro/images/2019_05_dsc03571.jpg">



  <link rel="alternate" href="/atom.xml" title="猫宁i" type="application/atom+xml">




  <link rel="canonical" href="http://blog.maoning.pro/archives/14348371.html">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Redis 深度探险（三）：Redis 单机环境搭建以及配置说明 | 猫宁i</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">猫宁i</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">趁着年轻，好好生活，用心折腾。</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives menu-item-active">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-books">

    
    
    
      
    

    

    <a href="/books/" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i> <br>书单</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.maoning.pro/archives/14348371.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="猫宁i">
      <meta itemprop="description" content="趁着年轻，好好生活，用心折腾。">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="猫宁i">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Redis 深度探险（三）：Redis 单机环境搭建以及配置说明

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-13 14:39:44" itemprop="dateCreated datePublished" datetime="2019-07-13T14:39:44+08:00">2019-07-13</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/archives/14348371.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/archives/14348371.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/archives/14348371.html" class="leancloud_visitors" data-flag-title="Redis 深度探险（三）：Redis 单机环境搭建以及配置说明">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数统计：</span>
                
                <span title="本文字数统计">37k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">33 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <img src="/images/2019_05_dsc03571.jpg" itemprop="contentUrl">
            
          

          
          </div>
        </div>
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>经过 Redis 深度探险系列的学习相信大家对 Redis 的数据结构、对象、持久化机制、过期键删除策略等知识有了大致的了解，本篇博文主要讲述 Redis 的安装步骤，然后介绍一下 Redis 配置说明，最后对 Redis 集群搭建进行详细的讲解。</p>
<a id="more"></a>
<h2 id="单机环境搭建"><a href="#单机环境搭建" class="headerlink" title="单机环境搭建"></a>单机环境搭建</h2><h3 id="Mac-安装-Redis"><a href="#Mac-安装-Redis" class="headerlink" title="Mac 安装 Redis"></a>Mac 安装 Redis</h3><p>Mac 中使用 brew 安装 Redis 的方法</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span><span class="keyword">install </span>redis</span><br></pre></td></tr></table></figure>
<h3 id="Linux-安装-Redis"><a href="#Linux-安装-Redis" class="headerlink" title="Linux 安装 Redis"></a>Linux 安装 Redis</h3><p><strong>Ubuntu 中使用 apt-get 安装 Redis 的方法</strong></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-<span class="builtin-name">get</span> install redis-server</span><br></pre></td></tr></table></figure>
<p><strong>CentOS7 中使用 yum 安装 Redis 的方法</strong></p>
<ol>
<li>检查 Redis 版本</li>
</ol>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 通过 yum <span class="meta">info</span> redis 可知 Centos7 中 Redis 源的版本为<span class="number">3</span>.<span class="number">2</span>.<span class="number">12</span></span><br><span class="line">$ yum <span class="meta">info</span> redis</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>安装 Redis 数据库</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum <span class="keyword">install</span> -y redis</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>启动 Redis 数据库</li>
</ol>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl <span class="literal">start</span> redis</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>查看 Redis 运行状况</li>
</ol>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>systemctl status redis</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>检测 Redis 服务器是否开启</li>
</ol>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">ps</span> -ef | <span class="keyword">grep</span> redis</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>通过上述方法安装的 Redis 版本较低，如果想安装最新的 Redis 请执行如下命令</li>
</ol>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装 Remi 的软件源</span></span><br><span class="line"><span class="symbol">$</span> yum install -y http:<span class="comment">//rpms.famillecollet.com/enterprise/remi-release-7.rpm</span></span><br><span class="line"><span class="comment">// 更换 yum 源，通过 remi 源安装 Redis</span></span><br><span class="line"><span class="symbol">$</span> yum --enablerepo=remi install -y redis</span><br></pre></td></tr></table></figure>
<h2 id="Redis-简单配置以及配置说明"><a href="#Redis-简单配置以及配置说明" class="headerlink" title="Redis 简单配置以及配置说明"></a>Redis 简单配置以及配置说明</h2><h3 id="Rdis设置为开启启动"><a href="#Rdis设置为开启启动" class="headerlink" title="Rdis设置为开启启动"></a>Rdis设置为开启启动</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl <span class="builtin-name">enable</span> redis.service</span><br></pre></td></tr></table></figure>
<h3 id="开启远程连接，Redis-默认只能-localhost-访问"><a href="#开启远程连接，Redis-默认只能-localhost-访问" class="headerlink" title="开启远程连接，Redis 默认只能 localhost 访问"></a>开启远程连接，Redis 默认只能 localhost 访问</h3><p>修改 /etc/redis.conf 配置文件，执行 systemctl restart redis 重启 Redis 即生效。</p>
<ol>
<li>输入命令 vim /etc/redis.conf 进入编辑模式</li>
<li>bind 127.0.0.1 修改为 bind 0.0.0.0</li>
<li>protected-mode yes 修改为 protected-mode no（保护模式，是否只允许本地访问）</li>
</ol>
<h3 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h3><p>修改 /etc/redis.conf 配置文件，在 requirepass foobared 前面去掉注释，将 foobared 改为自己的密码，我在这里改为 requirepass foobared，执行 systemctl restart redis 重启 Redis 即生效。</p>
<h3 id="在线变更配置"><a href="#在线变更配置" class="headerlink" title="在线变更配置"></a>在线变更配置</h3><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 通过 redis-<span class="keyword">cli</span> 连接 redis 客户端，使用 AUTH 进行认证</span><br><span class="line"><span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">6379</span>&gt; auth foobared</span><br><span class="line">// 获取当前配置</span><br><span class="line"><span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">6379</span>&gt; CONFIG GET *</span><br><span class="line">// 修改密码为 root</span><br><span class="line"><span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">6379</span>&gt; CONFIG SET requirepass root</span><br><span class="line">// 将修改后的配置写入配置文件</span><br><span class="line"><span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">6379</span>&gt; CONFIG REWRITE</span><br></pre></td></tr></table></figure>
<h2 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h2><p> <a href="http://download.redis.io/redis-stable/redis.conf" target="_blank" rel="noopener">Redis 配置文件 redis.conf </a> 以及Redis 配置文件 redis.conf 中文详解：</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Redis 配置文件例子.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 注意: 为了能读取到配置文件, Redis 服务必须以配置文件的路径作为第一个参数启动:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># ./redis-server /path/to/redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 单位说明: 当需要指定内存大小时, 可能会使用到不同的单位, 如 1k、5GB、4M 等, 这里给出其单位含义:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="meta"># 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="meta"># 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="meta"># 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="meta"># 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="meta"># 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 单位是大小写不敏感的 所以 1GB 1Gb 1gB 是一样的.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################## INCLUDES ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果你拥有一个标准的配置模板, 并且希望在该模板之上做一些个性化的修改, 你可以使用 include 指令来引入其他的配置文件.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 注意:"include" 不会被 admin 或者 Redis Sentinel "CONFIG REWRITE" 命令覆盖.</span></span><br><span class="line"><span class="meta"># 由于 redis 以最终的配置作为实际配置, 因此我们希望你将 include 命令放置在配置文件的最前面以防配置被覆盖.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如果你打算使用另外的 conf 文件来覆盖当前文件的配置, 那么最好将 include 指令放置到该文件的末尾. </span></span><br><span class="line"><span class="meta"># 即最后生效原则, 最后被解析的配置将作为最后的配置.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># include /path/to/local.conf</span></span><br><span class="line"><span class="meta"># include /path/to/other.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################## MODULES #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 启动时加载模块. 如果服务器无法加载模块, 它将中止. 可以使用多个 loadmodule 指令.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># loadmodule /path/to/my_module.so</span></span><br><span class="line"><span class="meta"># loadmodule /path/to/other_module.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################## NETWORK #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 默认情况下 redis 会在所有的可用网络接口中进行监听, 如果你想让 redis 在指定的网络接口中</span></span><br><span class="line"><span class="meta"># 监听, 那么可以使用 bind 命令来指定 redis 的监听接口.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 例如:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># bind 192.168.1.100 10.0.0.1</span></span><br><span class="line"><span class="meta"># bind 127.0.0.1 ::1</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># ~~~ 警告 ~~~ 如果允许所有的网络接口访问 Redis, 这样做是很危险的, 如果你只是需要本机访问 </span></span><br><span class="line"><span class="meta"># 可以指定特定的 127.0.0.1, 如果需要外网访问, 请配置防火墙策略.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span></span><br><span class="line"><span class="meta"># JUST COMMENT THE FOLLOWING LINE.</span></span><br><span class="line"><span class="meta"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line">bind <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 是否开启保护模式, 默认开启. 要是配置里没有指定 bind 和密码.</span></span><br><span class="line"><span class="meta"># 开启该参数后, redis 只会本地进行访问, 拒绝外部访问.</span></span><br><span class="line"><span class="meta"># 要是开启了密码和 bind, 可以开启. 否则最好关闭, 设置为 no.</span></span><br><span class="line"><span class="keyword">protected</span>-mode yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 在指定的端口上进行监听, 默认是 6379.</span></span><br><span class="line"><span class="meta"># 如果端口设置为 0, 那么 redis 就不会在 TCP socket 上进行监听.</span></span><br><span class="line">port <span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># TCP listen() backlog.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 在一个并发量高的环境中, 你需要指定一个比较大的 backlog 值来避免慢连接的情况.</span></span><br><span class="line"><span class="meta"># 注意, linux 内核会默认 使用 / proc/sys/net/core/somaxconn 的值来削减 backlog 的实际值,</span></span><br><span class="line"><span class="meta"># 因此你需要确保提升 somaxconn 和 tcp_max_syn_backlog 这两个值来确保此处的 backlog 生效.</span></span><br><span class="line">tcp-backlog <span class="number">511</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Unix socket.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 指定 unix sock 的路径来进行连接监听, 默认是不指定, 因此 redis 不会在 unix socket 上进行监听.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># unixsocket /tmp/redis.sock</span></span><br><span class="line"><span class="meta"># unixsocketperm 700</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 关闭掉空闲 N 秒的连接 (0 则是不处理空闲连接)</span></span><br><span class="line">timeout <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># TCP keepalive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 如果该值不为 0, 将使用 SO_KEEPALIVE 这一默认的做法来向客户端连接发送 TCP ACKs </span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 这样的好处有以下两个原因:</span></span><br><span class="line"><span class="meta"># 1) 检测已经死亡的对端 (译者注: TCP 的关闭会存在无法完成 4 次握手的情况, 如断电, 断网, 数据丢失等等)</span></span><br><span class="line"><span class="meta"># 2) 保持连接在网络环境中的存活</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 在 Linux 中, 该指定时间是一次发送 ACKs 的时间片.</span></span><br><span class="line"><span class="meta"># 对于其他内核系统, 其时间片大小与内核配置有关.</span></span><br><span class="line"><span class="meta"># 一个比较合理的值是 300 seconds.Redis 3.2.1 版本之后默认指定该值为 300 seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">tcp-keepalive <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################# GENERAL #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># redis 默认不是以一个守护进程来运行的, 使用 yes, 可以让 redis 作为守护进程来运行.</span></span><br><span class="line"><span class="meta"># 注意: 当 redis 作为守护进程的时候 /var/run/redis.pid 作为 pid 文件.</span></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果需要在机器启动 (upstart 模式 或 systemd 模式) 时就启动 Redis 服务器, 可以通过该选项来配置 Redis.</span></span><br><span class="line"><span class="meta"># 支持的模式:</span></span><br><span class="line"><span class="meta">#	supervised no      – 无, 不会与 supervised tree 进行交互</span></span><br><span class="line"><span class="meta"># 	supervised upstart – 将 Redis 服务器添加到 SIGSTOP 模式中</span></span><br><span class="line"><span class="meta"># 	supervised systemd – 将 READY=1 写入 $NOTIFY_SOCKET</span></span><br><span class="line"><span class="meta"># 	supervised auto    - 根据环境变量 UPSTART_JOB 或 NOTIFY_SOCKET 检测 upstart 还是 systemd</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 注意, 上述 supervision 方法 (upstart 或 systemd) 仅发出 “程序已就绪” 信号, 不会继续给 supervisor 返回 ping 回复.</span></span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果指定了 pid 文件, Redis 会在启动时写该 pid 文件, 在退出时删除该文件.</span></span><br><span class="line"><span class="meta"># 当 Redis 服务器已守护进程启动时, 如果指定了配置文件, 则直接使用, 如果没有指定, 则创建 / var/run/redis.pid 作为配置文件.</span></span><br><span class="line">pidfile /<span class="keyword">var</span>/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"><span class="meta"># 指定日志的记录级别的.</span></span><br><span class="line"><span class="meta"># 可以是如下的几个值之一:</span></span><br><span class="line"><span class="meta"># debug (尽可能多的日志信息, 用于开发和测试之中)</span></span><br><span class="line"><span class="meta"># verbose (少但是有用的信息, 没有 debug 级别那么混乱)</span></span><br><span class="line"><span class="meta"># notice (适量的信息, 用于生产环境)</span></span><br><span class="line"><span class="meta"># warning (只有非常重要和关键的信息会被记录)</span></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"><span class="meta"># 指定日志文件的位置. 为空时将输出到标准输出设备.</span></span><br><span class="line"><span class="meta"># 如果你在 demo 模式下使用标准输出的日志, 日志将会输出到 /dev/null .</span></span><br><span class="line">logfile /<span class="keyword">var</span>/log/redis/redis.log</span><br><span class="line"></span><br><span class="line"><span class="meta"># 当设置'syslog-enabled'为 yes 时, 允许记录日志到系统日志中.</span></span><br><span class="line"><span class="meta"># 以及你可以使用更多的日志参数来满足你的要求.</span></span><br><span class="line"><span class="meta"># syslog-enabled no</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 指定在系统日志中的身份.</span></span><br><span class="line"><span class="meta"># syslog-ident redis</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 指定系统日志的能力. 必须是 LOCAL0 到 LOCAL7 之间 (闭区间).</span></span><br><span class="line"><span class="meta"># syslog-facility local0</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置数据库的数量. 默认的数据库是 DB 0 使得你可以在每一个连接的基础之上使用 </span></span><br><span class="line"><span class="meta"># SELECT &lt;dbid&gt; 来指定另外的数据库, 但是这个值必须在 0 到'database'-1 之间.</span></span><br><span class="line">databases <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 默认情况下, Redis 只会在交互模式才显示 ASCII 版本的 logo, 可以通过设置此选项为 yes,</span></span><br><span class="line"><span class="meta"># 来使 Redis 在任何情况下都显示 logo, 使得 Redis 的此行为和 4.0 之前的版本行为保持一致.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">always-show-logo yes</span><br><span class="line"></span><br><span class="line"><span class="meta">################################ SNAPSHOTTING  ################################</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 将 DB 数据保存到磁盘:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 将会在 &lt; seconds&gt; 和 &lt;changes &gt; 两个值同时满足时, 将 DB 数据保存到硬盘中</span></span><br><span class="line"><span class="meta"># 其中 &lt; seconds&gt; 每多少秒,&lt;changes &gt; 是改变的 key 的数量</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 在以下的例子中, 将会存在如下的行为:</span></span><br><span class="line"><span class="meta"># 当存在最少一个 key 变更时, 900 秒 (15 分钟) 后保存到硬盘</span></span><br><span class="line"><span class="meta"># 当存在最少 10 个 key 变更时, 300 秒后保存到硬盘</span></span><br><span class="line"><span class="meta"># 当存在最少 1000 个 key 变更时, 60 秒后保存到硬盘</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 提示: 你可以禁用如下的所有 save 行.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 你可以删除所有的 save 然后设置成如下这样的情况.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># save ""</span></span><br><span class="line"></span><br><span class="line">save <span class="number">900</span> <span class="number">1</span></span><br><span class="line">save <span class="number">300</span> <span class="number">10</span></span><br><span class="line">save <span class="number">60</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 默认情况下, 在发生 RDB 快照或 BGSAVE 执行失败的那一刻, Redis 执行接收写请求.</span></span><br><span class="line"><span class="meta"># 这会使用户察觉 (通常比较困难) 到数据没有正确的持久化到磁盘. 否则有可能出现不被察觉的灾难性后果.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 当后台 BGSAVE 程序可以再次开始工作时, Reidis 会再次自动允许写入.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如果已经对 Server 和服务器持久化建立了正确的监控, 那么当你禁用该功能后, 即使磁盘、持久化等出现问题, Redis 也能继续提供服务.</span></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 是否在 dump 到 rdb 数据库的时候使用 LZF(一种高效的压缩算法) 来压缩字符串.</span></span><br><span class="line"><span class="meta"># 默认是 yes, 因为这是一个优良的做法.</span></span><br><span class="line"><span class="meta"># 如果你不想耗费你的 CPU 处理能力, 你可以设置为 no, 但是这会导致你的数据会很大.</span></span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 从 RDB 的版本 5 开始, CRC64 校验值会写入到文件的末尾.</span></span><br><span class="line"><span class="meta"># 这会使得格式化过程中, 使得文件的完整性更有保障,</span></span><br><span class="line"><span class="meta"># 但是这会在保存和加载的时候损失不少的性能 (大概在 10%).</span></span><br><span class="line"><span class="meta"># 你可以关闭这个功能来获得最高的性能.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># RDB 文件会在校验功能关闭的时候, 使用 0 来作为校验值, 这将告诉加载代码来跳过校验步骤.</span></span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># DB 的文件名称.</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="meta"># 工作目录.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># DB 将会使用上述'dbfilename'指定的文件名写入到该目录中.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 追加的文件也会在该目录中创建.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 注意, 你应该在这里输入的是一个目录而不是一个文件名.</span></span><br><span class="line">dir /<span class="keyword">var</span>/lib/redis</span><br><span class="line"></span><br><span class="line"><span class="meta">################################# REPLICATION #################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 主从复制. 单机模式下, Redis 支持使用 slaveof 命令从另一个 Redis 服务器的拷贝中来创建一个实例.</span></span><br><span class="line"><span class="meta"># 集群模式下则使用 cluster replicate &lt;master-id &gt; 命令. Redis 复制使用前须知:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#   +------------------+      +---------------+</span></span><br><span class="line"><span class="meta">#   |      Master      | ---&gt; |    Replica    |</span></span><br><span class="line"><span class="meta">#   | (receive writes) |      |  (exact copy) |</span></span><br><span class="line"><span class="meta">#   +------------------+      +---------------+</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 1)Redis 复制是异步复制, 但是可以配置连接的从节点数量.</span></span><br><span class="line"><span class="meta"># 2)当连接断开, Redis 从节点支持部分重同步 (psync) 功能来保证主从节点数据同步.</span></span><br><span class="line"><span class="meta"># 3)复制过程是一个自动化过程, 无需人工干预. 当出现网络分区后, 从节点会自动尝试建立与主节点的连接, 并尝试同步.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果主服务器开启了密码保护 (使用下面的 "requirepass" 配置).</span></span><br><span class="line"><span class="meta"># 这个配置就是告诉从服务在发起向主服务器的异步复制的请求之前使用如下的密码进行认证,</span></span><br><span class="line"><span class="meta"># 否则主服务器会拒绝这个请求.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># masterauth &lt;master-password&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果从服务器失去了和主服务器之间的连接, 或者当复制仍然处于处理状态的时候</span></span><br><span class="line"><span class="meta"># 从服务器做出如下的两个行为:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 1) 如果 slave-serve-stale-data 被设置为 yes(默认值), 从服务器将会持续</span></span><br><span class="line"><span class="meta"># 回复来自客户端的请求, 可能会回复已经过期的数据,</span></span><br><span class="line"><span class="meta"># 或者返回空的数据, 当从服务器第一次异步请求数据时.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 2) 如果 slave-serve-stale-data 被设置为 no ,</span></span><br><span class="line"><span class="meta"># 从服务器就会返回 "SYNC with master in progress"</span></span><br><span class="line"><span class="meta"># 这个错误, 来应答所有命令除了 INFO 和 SLAVEOF.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 你可以配置一个从服务器的实例是否接受写请求,</span></span><br><span class="line"><span class="meta"># 从服务器在存储一些短暂的数据的的时候, 接收写请求是一件非常正确的事情</span></span><br><span class="line"><span class="meta"># (因为数据在向主服务器同步之后非常容易擦除) 但是会因为配置不正确而导致一些问题.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 从 redis 2.6 开始默认从服务器是只读的服务器.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 提示: 只读的从服务器并不是设计用来公开给不受信任的互联网客户端的, 它</span></span><br><span class="line"><span class="meta"># 仅仅是一个用来防止对实例进行误操作的保护层. 只读从服务器默认用来输出管理命令</span></span><br><span class="line"><span class="meta"># 例如 CONFIG, DEBUG 和其他. 如果你想限制它的规模, 你可以使用'rename-command'来</span></span><br><span class="line"><span class="meta"># 提高它的安全性, 使得她作为一个影子来执行管理或者危险的命令.</span></span><br><span class="line">replica-read-only yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 是否使用 socket 方式复制数据. 目前 redis 复制提供两种方式, disk 和 socket.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 对于新连接的 slaves 或断开重连的 slaves 将无法执行 “部分同步”, 需要进行一次完全同步. 当进行完全同步时, 主节点将传播一个 RDB 文件给从节点. 该 RDB 文件的传播方式有两种:</span></span><br><span class="line"><span class="meta"># 1)基于磁盘: Redis 主节点创建一个新进程将 RDB 文件写到磁盘, 然后将生成的 RDB 文件传播给从节点.</span></span><br><span class="line"><span class="meta"># 2)无磁盘: Redis 主节点创建一个新进程直接将 RDB 文件写到 slaves 的套接字中, RDB 文件无需落盘.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 基于磁盘的复制, 一旦 RDB 文件生成, 多个 slaves 将排队等待并可以共享该文件. 而无磁盘复制一旦开始传输数据, 新 slaves 到来后将会排队等待.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 在使用无磁盘复制时, 主节点在开始传输同步数据前将根据配置的时间进行等待, 从而实现多个从节点的并发传输.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 在磁盘速度缓慢且网络速度很快 (高带宽) 时, 无磁盘复制效率更高. 默认情况下, 无磁盘复制同步关闭.</span></span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line"><span class="meta"># 无磁盘复制前, 主节点需要等待的时间. 该配置在启用无磁盘复制时将生效.</span></span><br><span class="line"><span class="meta"># 由于一旦开启一次数据传输, 其余 slaves 将排队等待, 所以最好让主节点等待一段时间, 这样主节点就可对多个 slaves 并发传播数据.</span></span><br><span class="line"><span class="meta"># 等待的单位是秒(second), 默认是 5 秒. 一旦将其设置为 0, 主节点将会马上开始数据传输.</span></span><br><span class="line">repl-diskless-sync-delay <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># slave 根据指定的时间间隔向服务器发送 ping 请求.</span></span><br><span class="line"><span class="meta"># 时间间隔可以通过 repl_ping_slave_period 来设置, 默认 10 秒.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># repl-ping-replica-period 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 复制连接超时时间. master 和 slave 都有超时时间的设置.</span></span><br><span class="line"><span class="meta"># master 检测到 slave 上次发送的时间超过 repl-timeout, 即认为 slave 离线, 清除该 slave 信息.</span></span><br><span class="line"><span class="meta"># slave 检测到上次和 master 交互的时间超过 repl-timeout, 则认为 master 离线.</span></span><br><span class="line"><span class="meta"># 需要注意的是 repl-timeout 需要设置一个比 repl-ping-slave-period 更大的值,</span></span><br><span class="line"><span class="meta"># 不然会经常检测到超时.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 以下情境将使用到复制超时阈值:</span></span><br><span class="line"><span class="meta"># 1) 从节点在执行 SYNC 期间, 检测块文件传输超时.</span></span><br><span class="line"><span class="meta"># 2) 从节点检测主节点离线(data、pings).</span></span><br><span class="line"><span class="meta"># 3) 主节点检测从节点离线(REPLCONF ACK).</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 必须要确保复制超时阈值 (repl-timeout) 大于 slaves 定时向 master 发送 PING 的时间片(repl-ping-slave-period),</span></span><br><span class="line"><span class="meta"># 否则将总会检测到复制超时(当 slave 发送 PING 的时间片大于复制超时阈值时, slave 还未发送 ping 就会被定性为复制超时).</span></span><br><span class="line"><span class="meta"># repl-timeout 60</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 执行完 SYNC 后, 是否要禁用 TCP_NODELAY.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 当禁用该功能后, Redis 会使用占用更少带宽的小 TCP 包向从节点发送数据.</span></span><br><span class="line"><span class="meta"># 但是这样做将会增大从节点端数据传输延时. 在 Linux 下禁用 TCP_NODELAY 功能将导致 40 微秒的延迟.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 当启动该功能后, 在进行复制时将会减少数据传输延迟, 但是会占用更大的带宽.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认情况下, 我们优先选择低延迟, 但是在高速网络或主从节点存在多 hops 路径时, 建议禁用 TCP_NODELAY 功能.</span></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置复制积压缓冲区 (replication backlog) 大小. 当 slaves 断开与节点连接后, Redis 使用复制积压缓冲区记录需要未发送给 slave 的数据.</span></span><br><span class="line"><span class="meta"># 当从节点重连后, 仅需执行一次部分同步, 将从节点缺失数据补全.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 复制积压缓冲区 (replication backlog) 越大, Redis 可以支持的 slave 离线时间就越长. 复制积压缓冲区用于部分重同步.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 复制缓冲区只有在有 slave 连接时才分配内存. 没有 slave 时, 该内存会被释放出来, 默认大小为 1m.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># repl-backlog-size 1mb</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 当主节点不再有新连接的从节点后, 复制积压缓冲区将会被释放.</span></span><br><span class="line"><span class="meta"># 为避免因从节点频繁掉线后上线而频繁的进行复制积压缓冲区的释放与申请, Redis 提供复制积压缓冲区释放时间片 (repl-backlog-ttl) 参数, 保证主节点在检测到从节点掉线后的规定时间内不会释放该缓冲区.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 值为零时表示不会释放该复制积压缓冲区, 单位为秒.</span></span><br><span class="line"><span class="meta"># 单位为秒, 配置如下:</span></span><br><span class="line"><span class="meta"># repl-backlog-ttl 3600</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 使用整数表示从节点优先级.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 当主节点无法正常工作后, Sentinel 将使用该优先级在从节点中推选出新的主节点.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 优先级对应的整数值越小, 被推选成主节点的可能性更大. 但是当优先级的值为零时表示该从节点不具备成为主节点的身份.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认优先级为 100.</span></span><br><span class="line">slave-priority <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 当主节点的已连接从节点数小于 N 且这些从节点延迟均大于 M 秒, 该主节点将停止接收写请求.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 从节点处于 “online” 状态, 当且仅当延迟 (通过计算距离上一次接收从节点的 ping 消息的时间间隔获得) 小于指定的阈值.</span></span><br><span class="line"><span class="meta"># 这个选项配置不是用来保证 N 个部分接收写信息, 而是为了在没有足够的从节点可用时, 限制写丢失.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如需要至少需要 3 个从节点并在 10s 内可用, 则设置:</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 延迟小于 min-slaves-max-lag 秒的 slave 才认为是健康的 slave.</span></span><br><span class="line"><span class="meta"># min-slaves-to-write 3</span></span><br><span class="line"><span class="meta"># 设置 1 或另一个设置为 0 禁用这个特性.</span></span><br><span class="line"><span class="meta"># min-slaves-max-lag 10</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 一旦对这两个中的一个赋值为零, 则该功能失效.</span></span><br><span class="line"><span class="meta"># 默认 min-slaves-to-write 参数设置为 0, 即该功能默认不启用.</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 主节点可以通过多种途径显示已连接从节点的 IP 和 port. 如 Sentinel 可以使用 “INFO replication” 命令来发现从节点实例；</span></span><br><span class="line"><span class="meta"># Master 可以使用 “ROLE” 命令显示从节点 IP 和 port 信息等.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># slave 获取 IP 和 port 的方式是:</span></span><br><span class="line"><span class="meta"># 	IP: 自动检测获取. 当从节点连接主节点时, 通过检查对应套接字地址获取.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#	Port: 从节点在复制中和主节点握手时需要使用到 port. 通常情况下, port 即为连接时的 port.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 但是, 当发生端口转发(port forwarding, 转发一个网络端口从一个网络节点到另一个网络节点的行为)</span></span><br><span class="line"><span class="meta"># 或使用 NAT(Network Address Translation, 网络地址转换)技术是, 从节点需要被分配不同 IP 和 port 后才能被访问.</span></span><br><span class="line"><span class="meta"># 接下来的两个配置用来设置从节点的 IP 和 port, 用来告知主节点所指定的 IP 和 port, 这样 INFO 和 ROLE 才能继续返回结果.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 当需要重写 IP 和 port 时, 则无需配置该选项.</span></span><br><span class="line"><span class="meta"># slave-announce-ip 5.5.5.5</span></span><br><span class="line"><span class="meta"># slave-announce-port 1234</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################## SECURITY ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Server 在处理客户端命令前, 该客户端需要提供提供认证密码. 这在非可信网络环境中很有用.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 为减少后台执行复杂度, 这个选项一般都会被注释掉. 因为大多数用户不需要授权.(如用户使用自己的服务器)</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># Warning: 由于 Redis 执行高效, 所以外部用户每秒可以尝试认证 15w 次.</span></span><br><span class="line"><span class="meta"># 也就是说, 为避免密码被快送攻破, 用户需要使用一个极其复杂的密码.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># requirepass foobared</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 重命名命令.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 在一个共享环境中有必要对危险命令进行重命令, 从而避免危险命令的滥用、无用.</span></span><br><span class="line"><span class="meta"># 如给 CONFIG 命令重新设置一个难以猜测的命令, 这样这个命令就很难被普通用户使用的, 但仍能被内部工具使用.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 例如:</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 设置成一个空的值, 可以禁止一个命令.</span></span><br><span class="line"><span class="meta"># rename-command CONFIG ""</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 注意, 一定要避免重命名那些写 AOF 文件或传输数据给 slaves 的命令, 否则将会导致各种难以预料的错误.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################### CLIENTS ####################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置能连上 redis 的最大客户端连接数量. 默认是 10000 个客户端连接.</span></span><br><span class="line"><span class="meta"># 由于 redis 不区分连接是客户端连接还是内部打开文件或者和 slave 连接等,</span></span><br><span class="line"><span class="meta"># 所以 maxclients 最小建议设置到 32. 如果超过了 maxclients,</span></span><br><span class="line"><span class="meta"># redis 会给新的连接发送’max number of clients reached’, 并关闭连接.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># maxclients 10000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">############################## MEMORY MANAGEMENT ################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># redis 配置的最大内存容量. 不要再内存超过指定限制时仍然使用内存.</span></span><br><span class="line"><span class="meta"># 当达到内存上限时, Redis 会根据选定的过期键策略移除一些 key.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如果根据过期键策略仍不能移除一些键或者过期键策略设置成 “noeviction”(不启用过期键策略),</span></span><br><span class="line"><span class="meta"># 那么 Redis 会向如 SET、LPUSH 等使用内存的命令返回错误, 向诸如 GET 等读命令正常返回结果.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 这个配置通常在将 Redis 当过 LRU 缓存或对以设置硬性的内存上限的 Redis 很适用.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># WARNING: slaves 的输出缓冲区不在主节点的 maxmemory 计算中, 所以设置的 maxmemory 不宜过大.</span></span><br><span class="line"><span class="meta"># 如果过大, 可能导致主机的剩余内存过小, 从而不能预留足够的内存用于创建 slaves 的输出缓冲区.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 简言之, 如果当前节点存在已连接的从节点, 建立设置一个较小的 maxmemory 上限, 这样系统就可以有多余的 RAM 用与创建从节点输出缓存.(当过期键策略设置成'noeviction'时, 则没有必要这么做)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># maxmemory &lt;bytes&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 内存容量超过 maxmemory 后的处理策略. Redis 提供五种内存淘汰策略:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># volatile-lru -&gt; 利用 LRU 算法移除设置过过期时间的 key.</span></span><br><span class="line"><span class="meta"># allkeys-lru -&gt; 利用 LRU 算法移除任何 key.</span></span><br><span class="line"><span class="meta"># volatile-lfu -&gt; 利用 LFU 算法移除设置过过期时间的 key.</span></span><br><span class="line"><span class="meta"># allkeys-lfu -&gt; 利用 LFU 算法移除任何 key.</span></span><br><span class="line"><span class="meta"># volatile-random -&gt; 随机移除设置过过期时间的 key.</span></span><br><span class="line"><span class="meta"># allkeys-random -&gt; 随机移除任何 key.</span></span><br><span class="line"><span class="meta"># volatile-ttl -&gt; 移除即将过期的 key, 根据最近过期时间来删除 (辅以 TTL)</span></span><br><span class="line"><span class="meta"># noeviction -&gt; 不移除任何 key, 只是返回一个写错误.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 上面的这些驱逐策略, 如果 redis 没有合适的 key 驱逐, 对于写命令, 还是会返回错误.</span></span><br><span class="line"><span class="meta"># redis 将不再接收写请求, 只接收 get 请求. 写命令包括: set setnx</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># maxmemory-policy noeviction</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># lru 检测的样本数. 使用 lru 或者 ttl 淘汰算法, 从需要淘汰的列表中随机选择 sample 个 key,</span></span><br><span class="line"><span class="meta"># 选出闲置时间最长的 key 移除.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认情况下, Redis 会从五个键中选择一个最近最久未使用的键进行淘汰. 可以通过配置该选择设置检测基数.</span></span><br><span class="line"><span class="meta"># 一般情况下, 五个检测样本可以获得足够好的结果. 10 个样本的结果更接近 LRU 算法, 但是会消耗更多的 CPU.</span></span><br><span class="line"><span class="meta"># 3 个样本可以获得较高的执行速度但是不够精确.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># maxmemory-samples 5</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 从 Redis 5 开始, 默认情况下, replica 节点会忽略 maxmemory 设置(除非在发生 failover 后, 此节点被提升为 master 节点).</span></span><br><span class="line"><span class="meta"># 这意味着只有 master 才会执行过期删除策略, 并且 master 在删除键之后会对 replica 发送 DEL 命令.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 这个行为保证了 master 和 replicas 的一致性, 并且这通常也是你需要的, 但是若你的 replica 节点是可写的,</span></span><br><span class="line"><span class="meta"># 或者你希望 replica 节点有不同的内存配置, 并且你确保所有到 replica 写操作都幂等的, 那么你可以修改这个默认的行为(请确保你明白你在做什么).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 需要注意的是默认情况喜爱 replica 节点不会执行过期策略, 它有可能使用了超过 maxmemory 设定的值的内存.</span></span><br><span class="line"><span class="meta"># 因此你需要监控 replicas 节点所在的机器并且确保在 master 节点到达配置的 maxmemory 大小时, replicas 节点不会超过物理内存的大小.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># replica-ignore-maxmemory yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">############################# LAZY FREEING ####################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 有两种方式删除键. 一种是使用如 DEL 这样的命令进行的同步删除. </span></span><br><span class="line"><span class="meta"># 同步删除意味着删除过程中服务端会停止处理新进来的命令. 若要删除的 key 关联了一个小的 object 删除耗时会很短.</span></span><br><span class="line"><span class="meta"># 若要删除的 key 管理了一个很大的 object, 比如此对象有上百万个元素, 服务端会阻塞相同长一段时间(甚至超过一秒).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 由于以上原因, Redis 同时提供了一种非阻塞的方式用于删除,</span></span><br><span class="line"><span class="meta"># 比如 UNLINK(非阻塞的 DEL)以及用于 FLUSHALL 和 FLUSHDB 的 ASYNC 选项, 这些命令能在后台回收内存.</span></span><br><span class="line"><span class="meta"># 这些命令能在常数时间内执行完毕. 其他线程会在后台尽快回收内存.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># DEL,UNLINK 以及用于 FLUSHALL 和 FLUSHDB 的 ASYNC 选项是用户可以控制的. </span></span><br><span class="line"><span class="meta"># 根据应用的设计, 用户可以选择使用阻塞或者非阻塞的方式. </span></span><br><span class="line"><span class="meta"># 但是作为某些命令的副作用 Redis 服务端有时会删除某些 object 或者 flush 整个数据库. </span></span><br><span class="line"><span class="meta"># 特别是以下独立于用户操作的情形: </span></span><br><span class="line"><span class="meta"># 1. 由于 maxmemory 和 maxmemory policy 配置导致的内存回收动作 </span></span><br><span class="line"><span class="meta"># 2. 由于过期, 当一个 key 过期后(可以查看 EXPIRE 命令获取相关信息), 必须回收其内存 </span></span><br><span class="line"><span class="meta"># 3. 由于某些命令的副作用, 比如 STORE 命令, 执行 STORE 命令可能需要删除已有的键. SET 命令需要删除已有的旧内容.</span></span><br><span class="line"><span class="meta"># 4. 在复制过程中, 当一个 replica 节点执行一个全量同步时, replica 需要删除整个数据库的内容以加载传输过来的 RDB 文件.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 在上述所有情形中, 删除 object 的默认行为都是以阻塞方式删除. 当然你可以配置上述四个选项来改变这种默认行为:</span></span><br><span class="line"></span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line"></span><br><span class="line"><span class="meta">############################## APPEND ONLY MODE ###############################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 默认 redis 使用的是 rdb 方式持久化, 这种方式在许多应用中已经足够用了.</span></span><br><span class="line"><span class="meta"># 但是 redis 如果中途宕机, 会导致可能有几分钟的数据丢失, 根据 save 来策略进行持久化,</span></span><br><span class="line"><span class="meta"># Append Only File 是另一种持久化方式, 可以提供更好的持久化特性.</span></span><br><span class="line"><span class="meta"># Redis 会把每次写入的数据在接收后都写入 appendonly.aof 文件,</span></span><br><span class="line"><span class="meta"># 每次启动时 Redis 都会先把这个文件的数据读入内存里, 先忽略 RDB 文件.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认情况下, Redis 会异步将数据集快照到磁盘上. 尽管这种模式对许多应用友好, 但是当 Redis 进程崩溃或发生掉电时,</span></span><br><span class="line"><span class="meta"># 几分钟内的写信息将丢失(根据快照执行的粒度).</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># AOF 作为一种可替换的持久化策略, 能够提供更好的耐久性.</span></span><br><span class="line"><span class="meta"># 如使用默认的 fsync 策略, Redis 仅会丢失 1s 的写信息, 当发生突发事件(服务器掉电、服务器进程崩溃但 OS 运行正常).</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># AOF 持久化和 RDB 持久化可以同时开启. 如果在启动 Redis 时已经存在 AOF 文件, 则会直接加载 AOF 文件(考虑到 AOF 文件相比 RDB 文件有更好的耐久性).</span></span><br><span class="line"><span class="meta"># 关于 AOF 的更多讯息见: http://redis.io/topics/persistence </span></span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"><span class="meta"># 指定 AOF 文件名称, 默认是 appendonly.aof.</span></span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 调用 fsync() 系统函数用来告知 OS 将数据写入磁盘, 而不是在输出缓冲区等待数据. 有些 OS 将直接 flush 数据到磁盘, 有些其他的 OS 仅会尝试去 flush.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># Redis 支持三种 fsync() 调用模式:</span></span><br><span class="line"><span class="meta"># no: 不执行 fsync, 由 OS 决定 flush 数据的频率. 高效. Linux 下默认是每 30s 执行一次 flush.</span></span><br><span class="line"><span class="meta"># always: 每写入一次 AOF 就调用一次 fsync. 慢, 最安全.</span></span><br><span class="line"><span class="meta"># everysec: 每秒调用一次 fsync, 可能会导致丢失这 1s 数据.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认 fsync 的调用频率是 “everysec”, 这种策略在执行速度和数据安全进行折中.</span></span><br><span class="line"><span class="meta"># 当可以容忍一定程度数据丢失并期望更高的性能时, 可以使用 “no” 策略(由操作系统决定 flush 的频率).</span></span><br><span class="line"><span class="meta"># 相反的, 如果不能容忍数据丢失, 可以使用 “always” 获得更好的安全性, 尽管执行更慢.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 在无法确定 fsync 调用频率时, 推荐使用 “everysec” 策略.</span></span><br><span class="line"><span class="meta"># 在开启 AOF 持久化功能后, 该配置才会生效.</span></span><br><span class="line"><span class="meta"># appendfsync always</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="meta"># appendfsync no</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 在 aof 重写或者写入 rdb 文件的时候, 会执行大量 IO, 此时对于 everysec 和 always 的 aof 模式来说,</span></span><br><span class="line"><span class="meta"># 执行 fsync 会造成阻塞过长时间, no-appendfsync-on-rewrite 字段设置为默认设置为 no.</span></span><br><span class="line"><span class="meta"># 如果对延迟要求很高的应用, 这个字段可以设置为 yes, 否则还是设置为 no,</span></span><br><span class="line"><span class="meta"># 这样对持久化特性来说这是更安全的选择. 设置为 yes 表示 rewrite 期间对新写操作不 fsync,</span></span><br><span class="line"><span class="meta"># 暂时存在内存中, 等 rewrite 完成后再写入, 默认为 no, 建议 yes.</span></span><br><span class="line"><span class="meta"># Linux 的默认 fsync 策略是 30 秒. 可能丢失 30 秒数据.</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 当 AOF 执行 fsync 的策略是 always 和 everysec 时, 如果此时有一个后台进程 (BGSAVE 进程或 AOF rewrite 进程) 正在执行大量的 I/O 操作到磁盘,</span></span><br><span class="line"><span class="meta"># 在一些 Linux 系统中, 执行 fsync 会造成较长的阻塞. 当前对这种情况还没有很好的解决策略, 即使在不同的线程中执行 fsync 也会导致调用同步 write(2) 阻塞.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 为了缓解上述问题, 可以通过配置下述选项来避免在主线程调用 fsync() 时执行 BGSAVE 或 BGREWRITEAOF 带来的阻塞.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 也就是说, 默认情况下, 当子进程执行 BGSAVE 或 BGREWRITEAOF 时, Redis 的耐久性将默认转变成 "appendfsync none".</span></span><br><span class="line"><span class="meta"># 在实际的应用中就意味着在最坏的场景下将丢失 30s 的数据, 即使配置了 fsync 调用频率为 always 或 everysec.(默认情况下, Linux 每 30s 自动调用一次 fsync 将缓存数据 flush 到磁盘)</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如果当前应用已考虑延迟问题, 则将该配置设置成 “yes”. 否则使用默认配置(“no”), 这是从耐久性角度考虑的最安全的选择.</span></span><br><span class="line">no-appendfsync-on-rewrite no </span><br><span class="line"></span><br><span class="line"><span class="meta"># aof 自动重写配置. 当目前 aof 文件大小超过上一次重写的 aof 文件大小的百分之多少进行重写,</span></span><br><span class="line"><span class="meta"># 即当 aof 文件增长到一定大小的时候 Redis 能够调用 bgrewriteaof 对日志文件进行重写.</span></span><br><span class="line"><span class="meta"># 当前 AOF 文件大小是上次日志重写得到 AOF 文件大小的二倍 (设置为 100) 时,</span></span><br><span class="line"><span class="meta"># 自动启动新的日志重写过程.</span></span><br><span class="line">auto-aof-rewrite-percentage <span class="number">100</span></span><br><span class="line"><span class="meta"># 设置允许重写的最小 aof 文件大小, 避免了达到约定百分比但尺寸仍然很小的情况还要重写</span></span><br><span class="line">auto-aof-rewrite-min-size <span class="number">64</span>mb</span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置 AOF 重写的触发条件.</span></span><br><span class="line"><span class="meta"># 当 AOF 日志按照指定的比例增长时, 可以通过调用 BGREWRITEAOF 执行自动的 AOF rewrite.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 工作原理: Redis 通过对比上一次执行 rewrite 时 AOF 文件的大小与当前 AOF 文件大小(在重启时将没有上一次执行 rewrite 的记录, 这时将使用 startup 时的 AOF 文件大小), 决定是否进行 rewrite.</span></span><br><span class="line"><span class="meta"># 如果当前 AOF 对于上一次执行 rewrite 的 AOF 文件的增长比率大于指定的比率, 将会触发一次 rewrite.</span></span><br><span class="line"><span class="meta"># 当然, 还需指定一个 AOF 进行重写的最小单位. 这样做可以避免增长比率已经达到要求, 但对应的 AOF 仍很小的情况 (这种情况下没有必要进行 rewrite) 的发生.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如果想要关闭自动 AOF rewrite 功能, 可将进行 rewrite 要求的增长比率设置 0.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认当 AOF 大于 64MB 且相比于上一次 rewrite,AOF 以扩充了两倍时会触发一次 rewrite 执行. 默认配置如下:</span></span><br><span class="line">auto-aof-rewrite-percentage <span class="number">100</span></span><br><span class="line">auto-aof-rewrite-min-size <span class="number">64</span>mb</span><br><span class="line"></span><br><span class="line"><span class="meta"># aof 文件可能在尾部是不完整的, 当 redis 启动的时候, aof 文件的数据被载入内存.</span></span><br><span class="line"><span class="meta"># 重启可能发生在 redis 所在的主机操作系统宕机后,</span></span><br><span class="line"><span class="meta"># 尤其在 ext4 文件系统没有加上 data=ordered 选项 (redis 宕机或者异常终止不会造成尾部不完整现象.)</span></span><br><span class="line"><span class="meta"># 出现这种现象, 可以选择让 redis 退出, 或者导入尽可能多的数据. 如果选择的是 yes,</span></span><br><span class="line"><span class="meta"># 当截断的 aof 文件被导入的时候, 会自动发布一个 log 给客户端然后 load.</span></span><br><span class="line"><span class="meta"># 如果是 no, 用户必须手动 redis-check-aof 修复 AOF 文件才可以.</span></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 在将 AOF 文件加载到内存时(重启 Redis), 可能会出现 AOF 被截断的情况.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如当 Redis 运行所在系统突然崩溃(当 ext4 文件系统在安装时没有配置成数据按序存储), 会出现 AOF 被截断情况.</span></span><br><span class="line"><span class="meta"># 如果 Redis 程序发生崩溃或异常, 但操作系统仍能正常工作, 则不会出现 AOF 被截断的情况.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 出现 AOF 被截断后, Redis 要么直接退出并返回错误, 要么加载被截断 AOF 中尽可能多的数据(当前默认方式).</span></span><br><span class="line"><span class="meta"># 可以通过 aof-load-truncated 选项进行配置:</span></span><br><span class="line"><span class="meta"># 当 aof-load-truncated 设置成 “yes”,Redis 仍会加载一个被截断的 AOF 文件, 同时向用户报告 AOF 文件被截断.</span></span><br><span class="line"><span class="meta"># 如果设置成 “no”,Redis 会直接返回错误并拒绝启动, 这时用户需要使用 "redis-check-aof" 程序修复 AOF, 只有这样才能重启 Server.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 注意, 如果 AOF 文件在执行一半时就出现问题, 即使设置 aof-load-truncated 为 “yes”,Redis 也会直接退出并返回错误.</span></span><br><span class="line"><span class="meta"># 这个配置仅在 Redis 尝试从 AOF 文件读更多数据但发现没有足够字计数存在时有意义.</span></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 当重写 AOF 文件时, Redis 可以使用 RDB 文件作为 AOF 文件的前导, 这样可以更快地进行重写和恢复. </span></span><br><span class="line"><span class="meta"># 当启用这个功能时 AOF 文件由两部分组成:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#   [RDB file][AOF tail]</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 当加载 AOF 文件时, Redis 通过以 “REDIS” 字符串开头的 AOF 文件识别出此文件是由 RDB 和 AOF 组合而成的,</span></span><br><span class="line"><span class="meta"># Redis 会先加载 RDB 部分, 然后再加载 AOF 部分.</span></span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line"><span class="meta">################################ LUA SCRIPTING  ###############################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置 Lua 脚本执超时的时间上限, 单位是毫秒, milliseconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 当 Lua 脚本执行超时, Redis 会记录脚本执行之后的结果 (超时后) 并向查询返回错误.</span></span><br><span class="line"><span class="meta"># 当一个长时脚本执行时间超过最大执行时间时, 只有 SCRIPT KILL 和 SHUTDOWN NOSAVE 命令可用.</span></span><br><span class="line"><span class="meta"># 停止这类脚本运行的第一个方法是调用一个非写命令. 第二种方法是 shut down 这个 server, 如果已经发送了一个写命令但用户并不想等待脚本自然终止.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如果想不限制脚本的执行时间并且不需要返回 warning, 可以将该参数设置成 0 或负数.</span></span><br><span class="line">lua-time-limit <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################ REDIS CLUSTER  ###############################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 正常情况下, 启动的 Redis 实例为非集群模式. 只有当节点配置成集群模式时才能成为集群节点.</span></span><br><span class="line"><span class="meta"># 如需以集群模式启动, 取消下述配置的注释即可:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># cluster-enabled yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 集群配置文件的名称, 每个节点都有一个集群相关的配置文件, 持久化保存集群的信息.</span></span><br><span class="line"><span class="meta"># 这个文件并不需要手动配置, 这个配置文件有 Redis 生成并更新,</span></span><br><span class="line"><span class="meta"># 每个 Redis 集群节点需要一个单独的配置文件, 请确保与实例运行的系统中配置文件名称不冲突.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># cluster-config-file nodes-6379.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 集群节点超时阈值用来作为节点不可达并被标记为失效状态的超时上限, 单位是毫秒(millisecond)</span></span><br><span class="line"><span class="meta"># 大部分其他内部时间将其基本参考数.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># cluster-node-timeout 15000</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 在进行故障转移的时候, 全部 slave 都会请求申请为 master,</span></span><br><span class="line"><span class="meta"># 但是有些 slave 可能与 master 断开连接一段时间了, 导致数据过于陈旧,</span></span><br><span class="line"><span class="meta"># 这样的 slave 不应该被提升为 master. 该参数就是用来判断 slave 节点与 master 断线的时间是否过长.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 没有简单的方式可以直接准确判定从节点的”data age”, 可以通过下面两个方面的检测实现:</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 1) 如果有多个从节点可以发起故障转移, 可以让他们交换信息以选出数据状态最节点主节点的从节点.</span></span><br><span class="line"><span class="meta"># 从节点可以通过 offset 进行排名并通过该排名延迟发起故障转移的时机.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 2) 每个独立的从节点计算最近一次与主节点交互的时间.</span></span><br><span class="line"><span class="meta"># 这里的交互可以是最近一次 PING、最近一次接收到来自主节点的命令、与主节点断开连接的时间(当复制链接已经 down 掉时).</span></span><br><span class="line"><span class="meta"># 如果最近一次与主节点的交互已经足够久远, 那么这个从节点将放弃进行故障转移.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 在 2) 中的时间阈值可以由用户设定. 特别地, 当从节点的最近一次与主节点的交互远大于 (node-timeout * slave-validity-factor) + repl-ping-slave-period 时, 这个从节点将不会执行故障转移.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 例如假设 node-timeout 为 30 秒, slave-validity-factor 参数为 10,repl-ping-slave-period 为 10 秒, 当从节点距离最近一次与主节点的交互时间大于 310 秒 (30*10+10) 时, 该从节点不能进行故障转移.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 一个过大的从节点有效因子 (slave-validity-factor) 会允许存储过旧数据的从节点进行故障转移, 而一个过小的从节点有效因子将会妨碍集群选择从节点成为新的主节点.</span></span><br><span class="line"><span class="meta"># 所以合理的设置从节点有效因子很重要.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 为了获得最大的可用性, 可以将从节点有效因子 (slave-validity-factor) 赋值为 0.</span></span><br><span class="line"><span class="meta"># 也就是说, 从节点忽略距离最近一次与主节点交互的时间段, 则是直接点尝试发起故障转移.(但是这种策略下, 这些从节点仍会根据 offset 的排名来推迟发起故障转移的时间)</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 从节点有效因子 (slave-validity-factor) 值为 0 是唯一可以保证网络分区消失后, 集群仍继续工作的值.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># cluster-replica-validity-factor 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 集群支持将从节点迁移到孤立主节点(orphaned masters), 没有可以工作从节点的主节点.</span></span><br><span class="line"><span class="meta"># 该功能减少了集群孤立主节点故障但没有可工作从节点进行故障转移的情况的发生.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 从节点可以迁移到孤立主节点当且仅当原来的主节点的剩余可工作从节点个数大于等于指定的可工作从节点数.</span></span><br><span class="line"><span class="meta"># 这个数称为从节点迁移屏蔽因子(migration barrier).</span></span><br><span class="line"><span class="meta"># 当迁移屏蔽因子设置为 1 时, 当且仅当主节点拥有至少两个可工作的从节点才允许其中从节点迁移到孤立主节点(orphaned masters).</span></span><br><span class="line"><span class="meta"># 该因子通常用来表明使用者需要为集群中的主节点配置从节点个数.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认迁移屏蔽因子是 1(从节点可以执行迁移当前仅当其主节点在该节点迁移后仍保有至少一个从节点).</span></span><br><span class="line"><span class="meta"># 如果想关闭该功能, 只需将该参数设置成一个极大值即可.</span></span><br><span class="line"><span class="meta"># 允许将迁移屏蔽因子置零. 这种行为仅在调试时有用, 且在生产环境中存在极大风险.</span></span><br><span class="line"><span class="meta"># cluster-migration-barrier 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 默认情况下, Redis 集群将停止接收客户端请求 (停止服务) 当集群检测到存在哈希槽没有对应负责的节点.</span></span><br><span class="line"><span class="meta"># 也就是说, 如果集群部分 down(如有一部分哈希槽没有对应的节点), 整个集群最终将会不可用.(集群信息传播遵循最终一致性)</span></span><br><span class="line"><span class="meta"># 当所有的槽都再次有对应负责的节点后, 集群将会自动再次可用.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 但是有时希望即使集群只有部分槽有对应的节点, 集群也能继续接受客户端请求并处理对应的键空间.</span></span><br><span class="line"><span class="meta"># 为了达到上述目的, 将 ecluster-require-full-coverage 设置为 “no” 即可.</span></span><br><span class="line"><span class="meta"># cluster-require-full-coverage yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 这个选项用于控制 master 发生故障时是否自动进行 failover.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 当设置为 yes 后 master 发生故障时不会自动进行 failover, 这时你可以进行手动的 failover 操作.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># cluster-replica-no-failover no</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># In order to setup your cluster make sure to read the documentation</span></span><br><span class="line"><span class="meta"># available at http://redis.io web site.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">########################## CLUSTER DOCKER/NAT support  ########################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 在某些部署环境下, Redis 集群的节点地址不能被自动发现, 这是因为这些节点是部署在 NAT 网络或者端口是转发的 (典型的情况就是使用了 Docker 或者其他容器).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 为了能让 Redis 集群工作在这种环境下, 我们需要进行相关配置让各个节点知道相互之间的外部地址,</span></span><br><span class="line"><span class="meta"># 这可以通过设置以下选项做到:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># * cluster-announce-ip: 表示节点的外部地址</span></span><br><span class="line"><span class="meta"># * cluster-announce-port: 表示节点的客户端口</span></span><br><span class="line"><span class="meta"># * cluster-announce-bus-port: 表示集群消息总线端口</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># Each instruct the node about its address, client port, and cluster message</span></span><br><span class="line"><span class="meta"># bus port. The information is then published in the header of the bus packets</span></span><br><span class="line"><span class="meta"># so that other nodes will be able to correctly map the address of the node</span></span><br><span class="line"><span class="meta"># publishing the information.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 若以上选项未配置, 则将会启用正常的 Redis 集群自动检测机制. </span></span><br><span class="line"><span class="meta"># 若 bus port 未设置, 则会将其设置为 port + 10000.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># Example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># cluster-announce-ip 10.1.1.5</span></span><br><span class="line"><span class="meta"># cluster-announce-port 6379</span></span><br><span class="line"><span class="meta"># cluster-announce-bus-port 6380</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################## SLOW LOG ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 慢日志系统用来记录执行时间较长的查询.</span></span><br><span class="line"><span class="meta"># 这里的执行时间 (“execution time”) 不包括 IO 操作时间, 如接收客户端的请求, 返回请求结果等,</span></span><br><span class="line"><span class="meta"># 而是实际执行命令的时间(此时线程处于阻塞状态, 仅能执行该命令, 不能同时处理其他请求).</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 可以使用两个参数配置慢日志: 一个参数告知 Redis 执行时间超时阈值(单位是微秒, microseconds), 这样一旦某个执行时间超过指定上限, 将会被记录到慢日志中；</span></span><br><span class="line"><span class="meta"># 另一个参数是慢日志的长度. 慢日志使用环式结构存储超时命令.(当慢日志满后, 新命令添加进去后, 最老的命令将被踢出)</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 单位是微秒(microsecon). 注意, 负数时间会禁用慢查询日志, 而 0 则会强制记录所有命令.</span></span><br><span class="line"><span class="meta"># 默认慢日志功能是开启的.</span></span><br><span class="line">slowlog-log-slower-than <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 慢查询日志长度. 当一个新的命令被写进日志的时候, 最老的那个记录会被删掉.</span></span><br><span class="line"><span class="meta"># 这个长度没有限制. 只要有足够的内存就行. 你可以通过 SLOWLOG RESET 来释放内存.</span></span><br><span class="line">slowlog-max-len <span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="meta">################################ LATENCY MONITOR ##############################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 延迟监测自系统通过对执行期间的操作的检测来收集与延迟相关的数据.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 通过使用 LATENCY 命令, Redis 用户可以获得延迟相关的图形、报告等信息.</span></span><br><span class="line"><span class="meta"># 延迟系统只会记录大于等于设置的 latency-monitor-threshold 值的操作. 当该值为零时,</span></span><br><span class="line"><span class="meta"># 则表明关闭 latency monitor.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 默认情况下, latency monitor 功能是关闭的, 因为大多数场景下并不需要该功能.</span></span><br><span class="line"><span class="meta"># latency monitor 可以在 Redis 运行时通过 "CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;" 启动.</span></span><br><span class="line">latency-monitor-threshold <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">############################# EVENT NOTIFICATION ##############################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 可以通知那些已 Pub/Sub 客户端键空间发生的事件.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 例如, 如果开启键空间通知功能且一个客户端对 0 号数据库上的 “foo”key 执行 DEL 操作, 那么 Redis 将使用 Pub/Sub 发送两条消息:</span></span><br><span class="line"><span class="meta"># PUBLISH __keyspace@0__:foo del</span></span><br><span class="line"><span class="meta"># PUBLISH __keyevent@0__:del foo</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># Redis 对通知的事件进行了分类, 每一类都使用唯一的字符标记:</span></span><br><span class="line"><span class="meta">#  K 	 键空间 (Key) 通知, 前缀为:__keyspace@&lt;db&gt;__ </span></span><br><span class="line"><span class="meta">#  E     键事件 (Event) 通知, 前缀为:__keyevent@&lt;db&gt;__ 对于所有命令类型和非键事件, 均使用小写字母表示, 且没有前缀.</span></span><br><span class="line"><span class="meta">#  g     一般命令(Generic commands), 如 DEL, EXPIRE, RENAME 等</span></span><br><span class="line"><span class="meta">#  $     字符串 (String) 命令</span></span><br><span class="line"><span class="meta">#  l     列表 (list) 命令</span></span><br><span class="line"><span class="meta">#  s     集合 (set) 命令</span></span><br><span class="line"><span class="meta">#  h     哈希 (hash) 命令</span></span><br><span class="line"><span class="meta">#  z     有序集合 (sorted set) 命令</span></span><br><span class="line"><span class="meta">#  x     过期事件(过期键产生的事件)</span></span><br><span class="line"><span class="meta">#  e     驱逐事件(因 maxmemory 而驱逐的事件)</span></span><br><span class="line"><span class="meta">#  A     g$lshzxe 等类型的别称(Alias), 如此一来就可以使用 "AKE" 代表所有的事件类型</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># notify-keyspace-events 可以指定多个字符组成的字符串或空串. 其中空串代表关闭通知功能.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 例 1: 为了开启 List 事件和 Genetic 事件(从事件名称分类来说), 可以使用如下设置:</span></span><br><span class="line"><span class="meta"># notify-keyspace-events Elg</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 例 2: 为了获取过期键的信息并发送到订阅的频道, 即__keyevent@0__:expired use 信息, 可设置如下:</span></span><br><span class="line"><span class="meta"># notify-keyspace-events Ex</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认情况下, 事件通知功能是关闭的, 因为大多数用户并不需要这个功能且这个功能会带来额外的性能开销.</span></span><br><span class="line"><span class="meta"># 注意, 如果没有指定键空间 (K) 通知还是键事件 (E) 通知, 那么任何事件通知都不会被传送.</span></span><br><span class="line">notify-keyspace-events <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">############################### ADVANCED CONFIG ###############################</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Hash 数据类型的底层实现有压缩链表 (ziplist) 和哈希表(hash).</span></span><br><span class="line"><span class="meta"># 当且仅当存储的数据量小于 hash-max-ziplist-entries 且节点占用的容量小于 hash-max-ziplist-value 时才使用小数据量存储高效的 ziplist 结构存储.</span></span><br><span class="line"><span class="meta"># 否则, 使用哈希结构存储.</span></span><br><span class="line">hash-max-ziplist-entries <span class="number">512</span></span><br><span class="line">hash-max-ziplist-value <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># List 类型也可以通过特殊的方式来节省空间.</span></span><br><span class="line"><span class="meta"># 每个内部 list 节点允许存储的 entries 数量可以指定为已修订最大数量或最大元素数.</span></span><br><span class="line"><span class="meta"># 如指定 - 5 到 - 1, 其含义是:</span></span><br><span class="line"><span class="meta"># -5: max size: 64 Kb  &lt;-- 对于普通的工作负载, 不建议使用</span></span><br><span class="line"><span class="meta"># -4: max size: 32 Kb  &lt;-- 不建议使用</span></span><br><span class="line"><span class="meta"># -3: max size: 16 Kb  &lt;-- 有时不建议使用</span></span><br><span class="line"><span class="meta"># -2: max size: 8 Kb   &lt;-- good</span></span><br><span class="line"><span class="meta"># -1: max size: 4 Kb   &lt;-- good</span></span><br><span class="line"><span class="meta"># 整数代表每个 list 节点准确存储指定数量的 elements</span></span><br><span class="line"><span class="meta"># 最高效的参数设置是 - 2 (8 Kb size) 或 -1 (4 Kb size)</span></span><br><span class="line"><span class="meta"># 但是, 如果需求很特殊, 则应根据需要调整参数:</span></span><br><span class="line">list-max-ziplist-size <span class="number">-2</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># List 可以实现压缩.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 压缩深度是划定 quicklist、ziplist 等 list 在压缩时的节点范围.</span></span><br><span class="line"><span class="meta"># 为了进行快速的 push/pop 操作, 不会对 list 的 head 和 tail 进行压缩, 只会对中间节点进行压缩.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 参数设置如下:</span></span><br><span class="line"><span class="meta"># 0: 关闭 list 压缩功能</span></span><br><span class="line"><span class="meta"># 1: 深度为 1 表示只有当 list 添加一个节点 (无论从 head 还是 tail 添加该节点) 后才开始进行压缩.</span></span><br><span class="line"><span class="meta"># 	 所以对于 [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span></span><br><span class="line"><span class="meta"># 	 只有黑体部分加入才会执行压缩操作.</span></span><br><span class="line"><span class="meta"># 2: 深度为 2</span></span><br><span class="line"><span class="meta"># 	 对于链表:[head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span></span><br><span class="line"><span class="meta"># 	 不会压缩 head 或 head-&gt;next 或 tail-&gt;prev 或 tail, 而仅压缩剩余部分.</span></span><br><span class="line"><span class="meta"># 3: 深度为 3</span></span><br><span class="line"><span class="meta">#  	 [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span></span><br><span class="line">list-compress-depth <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Set 数据类型的底层实现默认是 intSet, 也可以是 hash.</span></span><br><span class="line"><span class="meta"># Set 使用 hash 编码格式当且仅当字符串组成的 set 变成底数为 10 的整数, 且其值范围在 64 位整数中.</span></span><br><span class="line"><span class="meta"># 下面的配置设置用来指定 set 可以使用特殊编码格式的阈值:</span></span><br><span class="line"><span class="keyword">set</span>-max-intset-entries <span class="number">512</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Sorted Set 默认使用 ziplist 实现, 也可通过 skiplist 编码实现来节省空间.</span></span><br><span class="line"><span class="meta"># 当且仅当 Sorted Set 中元素值大于 zset-max-ziplist-value、元素数量大于 zset-max-ziplist-entries 时, 才使用 skiplist 实现 Sorted Set.</span></span><br><span class="line">zset-max-ziplist-entries <span class="number">128</span></span><br><span class="line">zset-max-ziplist-value <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># value 大小小于等于 hll-sparse-max-bytes 使用稀疏数据结构 (sparse),</span></span><br><span class="line"><span class="meta"># 大于 hll-sparse-max-bytes 使用稠密的数据结构 (dense).</span></span><br><span class="line"><span class="meta"># 一个比 16000 大的 value 是几乎没用的, 建议的 value 大概为 3000.</span></span><br><span class="line"><span class="meta"># 如果对 CPU 要求不高, 对空间要求较高的, 建议设置到 10000 左右.</span></span><br><span class="line">hll-sparse-max-bytes <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># HyperLogLog 稀疏表示阈值.</span></span><br><span class="line"><span class="meta"># 16 位的 header 部分也在 limit 中. 当使用稀疏表示的 HyperLogLog 存储的字节超过了指定的阈值, 它将转变成稠密表示.</span></span><br><span class="line"><span class="meta"># 不建议使用大于 16000 的值. 当小于 16000 时能够获得较高存储效率.</span></span><br><span class="line"><span class="meta"># 建议的值是 3000, 该值可以在较少 PFADD(在执行稀疏编码时时间复杂度是 O(N))操作执行的同时获得极高空间使用收益. 当 CPU 问题无需考虑时, 可将该值提升到 10000, 但其值不应超过 15000.</span></span><br><span class="line">hll-sparse-max-bytes <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Streams macro node max size / items. The stream data structure is a radix</span></span><br><span class="line"><span class="meta"># tree of big nodes that encode multiple items inside. Using this configuration</span></span><br><span class="line"><span class="meta"># it is possible to configure how big a single node can be in bytes, and the</span></span><br><span class="line"><span class="meta"># maximum number of items it may contain before switching to a new node when</span></span><br><span class="line"><span class="meta"># appending new stream entries. If any of the following settings are set to</span></span><br><span class="line"><span class="meta"># zero, the limit is ignored, so for instance it is possible to set just a</span></span><br><span class="line"><span class="meta"># max entires limit by setting max-bytes to 0 and max-entries to the desired</span></span><br><span class="line"><span class="meta"># value.</span></span><br><span class="line"><span class="meta"># 用于设定 Streams 单个节点的最大大小和最多能保存多个个元素.</span></span><br><span class="line">stream-node-max-bytes <span class="number">4096</span></span><br><span class="line">stream-node-max-entries <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 激活的 rehash 会占用每 100 毫秒的 1 millisecond 的 CPU 时间来对 Redis hash table(存储数据库的键值对的 hash table)执行 rehash.</span></span><br><span class="line"><span class="meta"># 在 Redis 中 hash table 使用惰性 rehash: 在 rehashing 时, hash table 中执行的操作越多, rehash 执行的步骤也越多.</span></span><br><span class="line"><span class="meta"># 所以当 server 很空闲时, rehash 将很简单, hash table 也会有更多的内存可以使用.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 为了在条件许可的情况下对 hash table 进行 rehash, 从而节省内存空间, 默认情况下, rehash 功能会每 100 毫秒中 1 毫秒被调用一次.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 如果不确定:</span></span><br><span class="line"><span class="meta"># 使用 "activerehashing no" 如果当前应用环境很注重延迟、Redis 仅允许 2 毫秒的延迟应答.</span></span><br><span class="line"><span class="meta"># 使用 "activerehashing yes" 如果当前应用环境不是太注重延迟且想要尽可能块的释放内存空间.</span></span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 客户端输出缓冲区可以用来强制断开那些不能够快速读取服务器数据的客户端连接.(如在 Pub/Sub 模式中, 客户端不能够快速的处理 publisher 发送过来的消息)</span></span><br><span class="line"><span class="meta"># 客户端类型可以细分为三类:</span></span><br><span class="line"><span class="meta"># 	normal -&gt; 普通客户端(包括 MONITOR 客户端)</span></span><br><span class="line"><span class="meta"># 	slave  -&gt; 从节点客户端</span></span><br><span class="line"><span class="meta"># 	pubsub -&gt; 订阅至少一个 pubsub 通道或模式的客户端</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># client-output-buffer-limit 设置的通用格式如下:</span></span><br><span class="line"><span class="meta"># 	client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 一旦 hard limit 达到, 客户端将直接断开连接. 如果 soft limit 达到, 客户端连接将会持续 soft seconds 后才断开连接.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 例如, 当 hard limit 是 32 MB(megabytes)、soft limit 在 10 秒内持续超过 16MB,</span></span><br><span class="line"><span class="meta"># 如果客户端输出缓冲区 (clients output buffer) 超过 32 MB 或客户客户端输出缓冲区 (clients output buffer) 超过 16MB, 并在接下来的 10 秒都高于 16MB, 客户端连接将马上断开.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认情况下, 不需对 normal 级别的 clients 进行约束因为这些客户端如果没有发起询问就不会接受数据.</span></span><br><span class="line"><span class="meta"># 所以, 只需对异步客户端进行约束因为异步客户端会出现请求速度大于 read 速度的情况.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 因为订阅者和从节点使用推的方式接受数据, 所以需要对 pubsub 客户端和 slave 客户端设置默认的客户端输出缓冲区约束.</span></span><br><span class="line"><span class="meta"># 将 hard limit 或 soft limit 置零表示关闭对应的功能.</span></span><br><span class="line">client-output-buffer-limit normal <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">client-output-buffer-limit slave <span class="number">256</span>mb <span class="number">64</span>mb <span class="number">60</span></span><br><span class="line">client-output-buffer-limit pubsub <span class="number">32</span>mb <span class="number">8</span>mb <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 客户端查询缓冲区会累加新的命令. </span></span><br><span class="line"><span class="meta"># 默认情况下, 他们会限制在一个固定的数量避免协议同步失效 (比如客户端的 bug) 导致查询缓冲区出现未绑定的内存.</span></span><br><span class="line"><span class="meta"># 但是, 如果有类似于巨大的 multi/exec 请求的时候可以修改这个值以满足你的特殊需求.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># client-query-buffer-limit 1gb</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 在 Redis 协议中, 批量请求通常限制在 512 mb 内, 可以通过修改 proto-max-bulk-len 选项改变这个限制.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># proto-max-bulk-len 512mb</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis 调用一个内部函数来执行后台任务, 如在 timeout 时关闭客户端连接, 清除从未被请求的过期键, 等等.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 虽然并不是所有的 tasks 都使用同样的频率执行, 但是 Redis 会根据指定的频率值来检测 tasks 的执行.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 默认设置的值为 10, 即每秒执行 10 次.</span></span><br><span class="line"><span class="meta"># 在 Redis 处于空闲提升该值时, 将会消耗更多的 CPU.</span></span><br><span class="line"><span class="meta"># 但是, 提升该值也会使 Redis 更精确的处理超时问题, 并检测到更多的过期键.</span></span><br><span class="line"><span class="meta"># </span></span><br><span class="line"><span class="meta"># 该值设置范围是 1 到 500. 但是不建议将其设置大于 100.</span></span><br><span class="line"><span class="meta"># 大多数的用户建议使用默认的值(10), 并根据应用环境的低延迟需求适当提升该值(峰值建议不要大于 100).</span></span><br><span class="line">hz <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 通常来说根据连接上来的客户端数量对 HZ 的值按比例进行调整是有用的.</span></span><br><span class="line"><span class="meta"># 这很有用, 例如, 为了避免每次后台任务处理太多的客户端, 从而避免高延迟峰值.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 默认情况下 HZ 的值为 10, 启用 dynamic-hz 后, 当有大量客户端连接进来时 HZ 的值会临时性地调高.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 启用 dynamic-hz 后, HZ 的配置值将作为基线, 当有大量的客户端连接进来时, Redis 会将 HZ 的实际值设置为 HZ 的配置值的整数倍.</span></span><br><span class="line"><span class="meta"># 通过这种方式, 空闲的 Redis 实例只会占用非常小的 CPU 时间, 当实例变得繁忙时 Redis 能更快地进行响应(相对未启用 dynamic-hz 的情况).</span></span><br><span class="line">dynamic-hz yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 当子进程进行 AOF 的重写时, 如果启用了 aof-rewrite-incremental-fsync, 子进程会每生成 32 MB 数据就进行一次 fsync 操作.</span></span><br><span class="line"><span class="meta"># 通过这种方式将数据分批提交到硬盘可以避免高延迟峰值.</span></span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># 当 Redis 保存 RDB 文件时, 如果启用了 rdb-save-incremental-fsync 功能, Redis 会每生成 32 MB 数据就执行一次 fsync 操作. </span></span><br><span class="line"><span class="meta"># 通过这种方式将数据分批提交到硬盘可以避免高延迟峰值.</span></span><br><span class="line">rdb-save-incremental-fsync yes</span><br><span class="line"></span><br><span class="line"><span class="meta"># Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</span></span><br><span class="line"><span class="meta"># idea to start with the default settings and only change them after investigating</span></span><br><span class="line"><span class="meta"># how to improve the performances and how the keys LFU change over time, which</span></span><br><span class="line"><span class="meta"># is possible to inspect via the OBJECT FREQ command.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># There are two tunable parameters in the Redis LFU implementation: the</span></span><br><span class="line"><span class="meta"># counter logarithm factor and the counter decay time. It is important to</span></span><br><span class="line"><span class="meta"># understand what the two parameters mean before changing them.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># The LFU counter is just 8 bits per key, it's maximum value is 255, so Redis</span></span><br><span class="line"><span class="meta"># uses a probabilistic increment with logarithmic behavior. Given the value</span></span><br><span class="line"><span class="meta"># of the old counter, when a key is accessed, the counter is incremented in</span></span><br><span class="line"><span class="meta"># this way:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 1. A random number R between 0 and 1 is extracted.</span></span><br><span class="line"><span class="meta"># 2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).</span></span><br><span class="line"><span class="meta"># 3. The counter is incremented only if R &lt; P.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># The default lfu-log-factor is 10. This is a table of how the frequency</span></span><br><span class="line"><span class="meta"># counter changes with a different number of accesses with different</span></span><br><span class="line"><span class="meta"># logarithmic factors:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta"># | factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</span></span><br><span class="line"><span class="meta"># +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta"># | 0      | 104        | 255        | 255        | 255        | 255        |</span></span><br><span class="line"><span class="meta"># +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta"># | 1      | 18         | 49         | 255        | 255        | 255        |</span></span><br><span class="line"><span class="meta"># +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta"># | 10     | 10         | 18         | 142        | 255        | 255        |</span></span><br><span class="line"><span class="meta"># +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta"># | 100    | 8          | 11         | 49         | 143        | 255        |</span></span><br><span class="line"><span class="meta"># +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># NOTE: The above table was obtained by running the following commands:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#   redis-benchmark -n 1000000 incr foo</span></span><br><span class="line"><span class="meta">#   redis-cli object freq foo</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># NOTE 2: The counter initial value is 5 in order to give new objects a chance</span></span><br><span class="line"><span class="meta"># to accumulate hits.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># The counter decay time is the time, in minutes, that must elapse in order</span></span><br><span class="line"><span class="meta"># for the key counter to be divided by two (or decremented if it has a value</span></span><br><span class="line"><span class="meta"># less &lt;= 10).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># The default value for the lfu-decay-time is 1. A Special value of 0 means to</span></span><br><span class="line"><span class="meta"># decay the counter every time it happens to be scanned.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># lfu-log-factor 10</span></span><br><span class="line"><span class="meta"># lfu-decay-time 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">########################### ACTIVE DEFRAGMENTATION #######################</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 警告: 这个功能是实验性的. 当然此功能已经在包括生产环境在内的环境中通过压力测试. </span></span><br><span class="line"><span class="meta"># 并且被多名工程师手工测过一段时间.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># What is active defragmentation?</span></span><br><span class="line"><span class="meta"># -------------------------------</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 活动碎片整理允许 Redis 服务器压缩内存中由于申请和释放数据块导致的碎片, 从而回收内存. </span></span><br><span class="line"><span class="meta"># 碎片是每次申请内存 (幸运的是 Jemalloc 出现碎片的几率小很多) 的时候会自然发生的. </span></span><br><span class="line"><span class="meta"># 通常来说, 为了降低碎片化程度需要重启服务, 或者至少需要清除所有的数据然后重新创建. </span></span><br><span class="line"><span class="meta"># 得益于 Oran Agra 在 Redis 4.0 实现的这个特性, 进程可以在服务运行时以 “热” 方式完成这些目的.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 通常来说当碎片化达到一定程度(查看下面的配置)Redis 会使用 Jemalloc 的特性创建连续的内存空间, </span></span><br><span class="line"><span class="meta"># 并在此内存空间对现有的值进行拷贝, 拷贝完成后会释放掉旧的数据. </span></span><br><span class="line"><span class="meta"># 这个过程会对所有的导致碎片化的 key 以增量的形式进行.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 需要重点理解的是: </span></span><br><span class="line"><span class="meta"># 1. 这个特性默认是关闭的, 并且只有在编译 Redis 时使用我们代码中的 Jemalloc 版本才生效.(这是 Linux 下的默认行为)</span></span><br><span class="line"><span class="meta"># 2. 如果没有碎片问题, 你永远不需要启用这项特性 </span></span><br><span class="line"><span class="meta"># 3. 如果你需要试验这项特性, 可以通过命令 CONFIG SET activefrag yes 来启用</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># 相关的配置参数可以很好的调整碎片整理过程. 如果你不知道这些选项的作用最好使用默认值.</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 启用碎片整理.</span></span><br><span class="line"><span class="meta"># activedefrag yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 有至少多少碎片时才开始碎片整理.</span></span><br><span class="line"><span class="meta"># active-defrag-ignore-bytes 100mb</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 有至少多少比例的碎片时才开始碎片整理.</span></span><br><span class="line"><span class="meta"># active-defrag-threshold-lower 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 有多少比例的碎片时才开始以最大努力进行碎片整理.</span></span><br><span class="line"><span class="meta"># active-defrag-threshold-upper 100</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 进行碎片整理时至少使用多少比例的 CPU 时间.</span></span><br><span class="line"><span class="meta"># active-defrag-cycle-min 5</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 最大努力进行碎片整理时使用多少 CPU 时间.</span></span><br><span class="line"><span class="meta"># active-defrag-cycle-max 75</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 进行主字典扫描时处理的 set/hash/zset/list 字段的最大数量</span></span><br><span class="line"><span class="meta"># (就是说在进行主字典扫描时 set/hash/zset/list 的长度小于这个值才会处理, 大于这个值的会放在一个列表中延迟处理).</span></span><br><span class="line"><span class="meta"># active-defrag-max-scan-fields 1000</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="参考博文"><a href="#参考博文" class="headerlink" title="参考博文"></a>参考博文</h2><p>[1]. <a href="http://download.redis.io/redis-stable/redis.conf" target="_blank" rel="noopener">Redis 配置文件 redis.conf </a><br>[2]. <a href="https://www.redis.net.cn/order/" target="_blank" rel="noopener">Redis 命令</a><br>[3]. <a href="http://blog.didispace.com/%E9%98%BF%E9%87%8C%E4%BA%91Redis%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/" target="_blank" rel="noopener">阿里云 Redis 开发规范</a></p>
<hr>
<h2 id="Redis-深度探险系列"><a href="#Redis-深度探险系列" class="headerlink" title="Redis 深度探险系列"></a>Redis 深度探险系列</h2><ul>
<li><a href="8fb486e9.html">Redis 深度探险（一）：那些绕不过去的 Redis 知识点</a></li>
<li><a href="e993c76c.html">Redis 深度探险（二）：Redis 深入之道</a></li>
<li><a href="14348371.html">Redis 深度探险（三）：Redis 单机环境搭建以及配置说明</a></li>
<li><a href="d63e1e23.html">Redis 深度探险（四）：Redis 高可用性解决方案之哨兵与集群</a></li>
</ul>
<hr>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>谢谢你长得那么好看，还打赏我！😘</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.jpg" alt="猫宁i 微信支付">
        <p>微信支付</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/alipay.jpg" alt="猫宁i 支付宝">
        <p>支付宝</p>
      </div>
    

  </div>
</div>

      </div>
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>猫宁i</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="http://blog.maoning.pro/archives/14348371.html" title="Redis 深度探险（三）：Redis 单机环境搭建以及配置说明">http://blog.maoning.pro/archives/14348371.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/安装教程/" rel="tag"># 安装教程</a>
          
            <a href="/tags/配置说明/" rel="tag"># 配置说明</a>
          
            <a href="/tags/Redis/" rel="tag"># Redis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/archives/c0dca125.html" rel="next" title="Git 在团队中的最佳实践（二）：如何正确使用 Git flow 工作流">
                <i class="fa fa-chevron-left"></i> Git 在团队中的最佳实践（二）：如何正确使用 Git flow 工作流
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/archives/46faebc7.html" rel="prev" title="MySQL 进阶讲解（二）：快速生成测试数据以及 EXPLAIN 详解">
                MySQL 进阶讲解（二）：快速生成测试数据以及 EXPLAIN 详解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpeg" alt="猫宁i">
            
              <p class="site-author-name" itemprop="name">猫宁i</p>
              <div class="site-description motion-element" itemprop="description">趁着年轻，好好生活，用心折腾。</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">81</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://morning-pro.github.io/" title="https://morning-pro.github.io/" rel="noopener" target="_blank">我的镜像站</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://crossoverjie.top/" title="https://crossoverjie.top/" rel="noopener" target="_blank">crossoverJie's Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://fangjian0423.github.io/" title="http://fangjian0423.github.io/" rel="noopener" target="_blank">Format's Notes</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.fangjunhao.com/" title="https://www.fangjunhao.com/" rel="noopener" target="_blank">渣博客</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单机环境搭建"><span class="nav-number">2.</span> <span class="nav-text">单机环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mac-安装-Redis"><span class="nav-number">2.1.</span> <span class="nav-text">Mac 安装 Redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-安装-Redis"><span class="nav-number">2.2.</span> <span class="nav-text">Linux 安装 Redis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-简单配置以及配置说明"><span class="nav-number">3.</span> <span class="nav-text">Redis 简单配置以及配置说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rdis设置为开启启动"><span class="nav-number">3.1.</span> <span class="nav-text">Rdis设置为开启启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开启远程连接，Redis-默认只能-localhost-访问"><span class="nav-number">3.2.</span> <span class="nav-text">开启远程连接，Redis 默认只能 localhost 访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置密码"><span class="nav-number">3.3.</span> <span class="nav-text">设置密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在线变更配置"><span class="nav-number">3.4.</span> <span class="nav-text">在线变更配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件详解"><span class="nav-number">4.</span> <span class="nav-text">配置文件详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考博文"><span class="nav-number">5.</span> <span class="nav-text">参考博文</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-深度探险系列"><span class="nav-number">6.</span> <span class="nav-text">Redis 深度探险系列</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-paper-plane"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">猫宁i</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">博客全站字数：</span>
    
    <span title="博客全站字数">447k</span>
  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>







  






  



  
    
    
  
  <script color="0,0,0" opacity="0.3" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



  

<script src="//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: '2saqKR15nDJaNg0KgkpiEIIB-gzGzoHsz',
    appKey: 'NBf24H2IPzFCX7DjwNXFpDbH',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn'
  });
</script>




  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7},"log":false,"tagMode":false});</script></body>
</html>
